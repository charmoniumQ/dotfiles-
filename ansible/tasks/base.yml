---
- name: Install base packages
  xbps: name={{item}} state=present update_cache=yes
  with_items:
    - sudo # TODO: replace with doas
    - nano
    - emacs
    - tmux
    - openssh
    - htop
    - bind-utils
    - nmap
    - wget
    - curl
    - git
    - iputils
    - zsh
    - ntfs-3g
    - exfat-utils
  become: yes
  become_user: root

- name: Add xbps sources
  copy: src=files/etc/xbps.d/ dest=/etc/xbps.d
  become: yes
  become_user: root

- name: Add downloads folder
  file: path="~/Downloads" state=directory

- name: Add documents folder
  file: path="~/Documents" state=directory

- name: Get the username
  local_action: command whoami
  register: username

- name: Get the zsh path
  local_action: command which zsh
  register: zsh_path

- name: Add zsh as shell
  lineinfile: dest=/etc/shells line={{zsh_path.stdout}} state=present
  become: yes
  become_user: root

- name: Make zsh the login shell
  user: name={{username.stdout}} shell={{zsh_path.stdout}} state=present
